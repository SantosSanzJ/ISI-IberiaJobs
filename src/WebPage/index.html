<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IberiaJobs</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <nav>
      <h1>Iberia Jobs</h1>
      <ul>
        <li><a href="#home">Home</a></li>
        <li><a href="#graphStats">Stats</a></li>
      </ul>
    </nav>
    <section id="home">
      <div class="container">
        <div>
          <div>
            <label for="input">Searching for...</label>
          </div>
          <div>
            <input type="text" id="input" placeholder="Job, company or keyword">
          </div>
        </div>
          
        <div>
          <div>
            <label for="opcion">From...</label>
          </div>
          <div>
            <select id="opcion" name="opcion">
              <option value="Spain">Spain</option>
              <option value="EEUU">EEUU</option>    
            </select>
          </div>
        </div>
          
      <div id="lastDiv">
        <div></div>
        <div>
          <button type="submit" id="search">Search</button>
        </div>
      </div>
        
      </div>
    </section>
    <section id="stats">
      <div id="noResults">
      </div>
      <div id="results">
      </div>
    </section>
    <section id="graph">
      <div id="graphStats">
        <canvas id="grafico" width="100%" height="100%"></canvas>
      </div>
    </section>
    <script src="js/TopDownBar.js"></script>
    <script src="js/stats.js"></script>
    <script src="..\..\package\dist\chart.umd.js"></script>
    <script src="..\..\package\dist\jquery-3.6.4.min.js"></script>
    <script>
      var arrEsNames = []
      var arrUsaNames = []
      var arrEsVal = []
      var arrUsaVal = []
      var counterArrEs = 0
      var counterArrUSA = 0
      let chart;
      fetch('http://127.0.0.1:5000/graph', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ val: 1})
        })
        .then(response => response.json())
        .then(data => {
            for (const item of data) {
                counterArrEs += 1;
                for (var i in item){
                  if(i == "FrecuenciaEs"){
                    arrEsVal.push(item[i]);
                  }else if (i == "Keyword"){
                    arrEsNames.push(item[i]);
                  }
                }
                if(counterArrEs == 5){
                    break;
                }
            }
        });
        fetch('http://127.0.0.1:5000/graph', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ val: 0})
          })
          .then(response => response.json())
          .then(data => {
              for (const item of data) {
                  counterArrUSA += 1
                  for (var i in item){
                    if(i == "FrecuenciaUSA"){
                      arrUsaVal.push(item[i]);
                    }else if (i == "Keyword"){
                      arrUsaNames.push(item[i]);
                    }
                  }
                  if(counterArrUSA == 5){
                      break;
                  }
                  doGraph(arrEsVal, arrEsNames, arrUsaVal, arrUsaNames);
              }
        });
      function doGraph(arrEsVal, arrEsNames, arrUsaVal, arrUsaNames, chart){
        let canvas = document.getElementById("grafico");
        chart = new Chart(canvas, {
            type: "bar",
            data: {
                labels:[arrEsNames[0], arrEsNames[1], arrEsNames[2], arrEsNames[3], arrEsNames[4]],
                datasets:[{
                    label:"Las tecnologías más usadas en España",
                    backgroundColor: "rgba(22,125,183,0.7)",
                    data:[arrEsVal[0], arrEsVal[1], arrEsVal[2], arrEsVal[3], arrEsVal[4]]
                }
              ],
            }
        });
      }
    </script>
  </body>
</html>
